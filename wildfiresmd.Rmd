---
title: "Wildfire analysis with ggplot and leaflet"
author: "Aaron Long"
date: "2/04/2020"
output:
  prettydoc::html_pretty:
    theme: tactile
    highlight: github
---


# Introduction:

Back in 2017, the Tubbs Fire in Santa Rosa had not only destroyed my family's home, but also completely destroyed our neighborhood. With losing 95% of our belongings including irreplaceable photographs and mementos, it was a truly devastating event that traumatized me and my family.

For this report, I am exploring a dataset on the 1.88 million wildfires that occurred in the US from 1992-2015.This dataset can be found in Kaggle: https://www.kaggle.com/rtatman/188-million-us-wildfires. I will briefly look at all the data then dive into large fires only. This means fires in class size F (1000-5000)acres burned and size G with is wildfires burning over 5000+ acres. Some of the largest fires in CA for example burned hundreds of thousands of acres. I want to focus on California and Florida as this is where I live now and where the data would be most relevant to me.



## Tubbs Fire Pictures
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE,warning = FALSE, fig.align = 'center')
```

```{r house, echo=FALSE, out.width = '90%'}
knitr::include_graphics("https://i.imgur.com/MWA1ILo.jpg")
```

Before: Our home before the Tubbs Fire.

```{r post-house, echo=FALSE, out.width = '90%'}
knitr::include_graphics("https://i.imgur.com/BMqJNqd.jpg")
```

After: Our home a few days later after the Tubbs Fire.


```{r rebuilding, echo=FALSE, out.width = '90%'}
knitr::include_graphics("https://i.imgur.com/E40bXd7.jpg")
```

After two years of hardship and dealing with the situation, we were fianlly able to begin building the house in 2019.


## Getting Started

### Load in the Libraries used for the Dataset
To begin the process, load in the necessary libraries needed for SQLite, ggplot, dplyr, map data, and leaflet.

```{r library}
library(RSQLite)
library(ggplot2)
library(xts)
library(ggfortify)
library(ggthemes)
library(maps)
library(mapdata)
library(leaflet)
library(dbplyr)
library(dplyr)
library(purrr)
```

### Load the Data
Connect to the SQLite database and load in the data. Then, disconnect the connection to the data to free up computer resources such as memory or CPU.
```{r data}
# use SQLite to load in database 
conn <- dbConnect(SQLite(), 'C:/Users/blong/Desktop/Python/188-million-us-wildfires/FPA_FOD_20170508.sqlite')

# pull the fires table into RAM
fires <- tbl(conn, "Fires") %>% collect()

# disconnect from database to free up resources like memory
dbDisconnect(conn)
```

By using glimpse, it provides an overall idea of how the data is presented. For instance, this data contains 39 columns and 1.8 million rows. Several useful columns includes, but not limited to, FIRE_YEAR, or FIRE_SIZE.

```{r info}
glimpse(fires)
```

##  Exploring the Data

### Bar Charts
With the data provided, I am using ggplot to create barplots that will initially help with getting a better understanding of the data. For this example, I'm only reveaing a small portion of the code as a sample (for an easier understanding). 

Note: Feel free to message or email me if you are interested in looking at the R file with the rest of the code in detail.

```{r US chart1, out.width = '100%'}
fires %>% 
  group_by(FIRE_YEAR) %>%
  summarize(n_fires = n()) %>%
  ggplot(aes(x = FIRE_YEAR, y = n_fires/1000)) + 
  geom_bar(stat = 'identity', fill = '#FCBE00') +
  geom_smooth(method = 'lm', se = FALSE, linetype = 'dashed', size = 0.8, color = '#FF2F00') + 
  labs(x = 'Year', y = 'number of wildfires by thousands', title = 'United States Wildfires from 1992 to 2015')+
  theme(plot.title = element_text(hjust=0.5))
```

This chart illustrates all the wildfires in the Unites States from 1992 to 2015. The blue dotted-line demonstrates a small uptick in the number of wildfires in the US from 1992-2015. This indicates that there is an increase in fires from 1992 to 2015. As you can see, 2006 has the most fires by approximately 56,000 more wildfires, while 1997 has the least amount.


```{r US chart2, echo = FALSE, out.width = '100%'}
fires %>%
  group_by(STAT_CAUSE_DESCR) %>%
  summarize(n_fires = n()/1000) %>%
  ggplot(aes(x = reorder(STAT_CAUSE_DESCR, n_fires), y = n_fires)) +
  geom_bar(stat = 'identity', fill = '#FCBE00') + 
  coord_flip() + 
  labs(x = '', y = 'Number of wildfires by thousands', title = 'United States Wildfires: Causes from 1992 to 2015')+
  theme(plot.title = element_text(hjust=0.5))

```

This graph presents 13 different causes of wildfires from 1992-2015. According to the data, the four major causes of wilfires include debris burning, miscellaneous, arson, and lightening. Surprisingly, the three lowest causes are structures, fireworks, and powerlines.

```{r US chart3, echo = FALSE, out.width = '100%'}
fires %>% 
  group_by(FIRE_SIZE_CLASS) %>%
  summarize(n = n()/1000) %>%
  ggplot(aes(x = FIRE_SIZE_CLASS, y= n)) +
  geom_bar(stat = 'identity',  fill='#FCBE00') +
  labs(x = 'Fire size in acres', y = 'number of wildfires by thousands', title = 'Number of Wildfires by class size') +
  scale_x_discrete(labels=c('A' = '0-0.25', 'B' = '0.26-9.9', 'C' = '10.0-99.9', 'D' = '100-299', 'E' = '300-999',
                            'F' = '1000-4999', 'G' = '5000+'))+
  theme(plot.title = element_text(hjust=0.5))
```

For this graph, the wildfires are divided into seven class size categories. According to the data, 0.25-9.9 has the highest amount of wildfires having approximately 94,000 wildfires. 

### Map Data
To start creating maps, load in the data for the map. I also created new variables such as region and fire duration.

```{r US map data, out.width = '100%'}
states <- map_data("state")
counties <- map_data("county")

state.abb <- append(state.abb, c("DC", "PR"))
state.name <- append(state.name, c("District of Columbia", "Puerto Rico"))

# Map the state abbreviations to state names so we can join with the map data
fires$region <- map_chr(fires$STATE, function(x) { tolower(state.name[grep(x, state.abb)]) })
fires$BURN_TIME <- fires$CONT_DATE - fires$DISCOVERY_DATE
```

#### US Maps
Below are two US Maps that illustrate the number of wildfires by each state from 1992 to 2015.

```{r US map1, out.width = '100%' }
fires %>% 
  select(region) %>%
  group_by(region) %>%
  summarize(n = n()) %>%
  right_join(states, by = 'region') %>%
  ggplot(aes(x = long, y = lat, group = group, fill = n)) + 
  geom_polygon() + 
  geom_path(color = 'white') + 
  scale_fill_continuous(low = "#FCBE00", high = "#FF2F00", name = 'Number of Wildfires') + 
  theme_map() + 
  coord_map('albers', lat0=30, lat1=40) + 
  ggtitle("United States Wildfires from 1992 to 2015") + 
  theme(plot.title = element_text(hjust = 0.5))
```
This first maps displays the total count of wildfires. Based on the data, California, Texas, and surprisingly Georgia had the most fires.
 
```{r US map2 ,echo = FALSE, out.width = '100%'}
fires %>% 
  filter( ( FIRE_SIZE_CLASS=='F'| FIRE_SIZE_CLASS=='G')) %>%
  select(region) %>%
  group_by(region) %>%
  summarize(n = n()) %>%
  right_join(states, by = 'region') %>%
  ggplot(aes(x = long, y = lat, group = group, fill = n)) + 
  geom_polygon() + 
  geom_path(color = 'white') + 
  scale_fill_continuous(low = "#FCBE00", high = "#FF2F00", name = 'Number of Wildfires') + 
  theme_map() + 
  coord_map('albers', lat0=30, lat1=40) + 
  ggtitle("Large Wildfire (1000+ acres burned) in United States from 1992 to 2015") + 
  theme(plot.title = element_text(hjust = 0.5))
```

The second map only displays large fires that are over 1000 acres or more. According to the map, it displays that large fires occur more across the West of the US Map. The states with the largest amount of fires includes California, Texas, and now Idaho. The gray states (Vermont, Massachusetts, New Hampshire, and Rhode Island) indicate a lack of large wildfires because these states are small in size and are generally colder climates.  

### Large Wildfires in California and Florida
Next, there will be a focus shift on size class F and G (1000 acres or more) wildfires in California and Florida. The reason I chose California and Florida because they are both places that I've lived in, and am currently living in.

```{r state data}
#create a data frame of california and florida with stat map data package and counties
ca_df <- states %>%
  filter(region == "california")
ca_county <- counties %>%
  filter(region == "california")


fl_df <- states %>%
  filter(region == "florida" )
fl_county <- counties %>%
  filter(region == "florida" )


#Create dataframes of just california and florida
ca_FG_fires <- fires %>%
  filter(region == "california" ,( FIRE_SIZE_CLASS=='F'| FIRE_SIZE_CLASS=='G'))

fl_FG_fires <- fires %>%
  filter(region == "florida" ,( FIRE_SIZE_CLASS=='F' | FIRE_SIZE_CLASS=='G'))
```

### Large Wildfires in California

```{r CAmap2, out.width = '100%'}
CAmap_year <- ggplot() +
  geom_polygon(data = ca_df,aes(x = long, y = lat, group = group), colour = "black") + 
  geom_polygon(data = ca_county, aes(x = long, y = lat,group=group),colour='white')+
  geom_point(data = ca_FG_fires,  aes(x = LONGITUDE, y = LATITUDE,colour=ca_FG_fires$FIRE_YEAR))+ 
  scale_colour_gradient(low = "yellow", high = "red", name='Year')+
  labs(title='Large Wildfires by Year in California', x='Longitude', y ='Latitude')
  CAmap_year + theme_light()+ theme(plot.title = element_text(hjust=0.5))
```
This map illustrates large wildfires in California between 1992-2015 in increments of 5 years. It indicates that the years from 1995-2000 and 2005-2010 had the most large wildfires in California. It also reveals that most of the 1992-1995 wildfires where from Southern California, and then after 2005, there was a shift of large fires to Northern California.

```{r CAchart2 ,echo = FALSE, out.width = '100%'}
ca_FG_fires %>% 
  group_by(FIRE_YEAR) %>%
  summarize(n = sum(FIRE_SIZE)) %>%
  ggplot(aes(x = FIRE_YEAR, y = n)) + 
  geom_bar(stat = 'identity', fill = '#FCBE00') +
  geom_smooth(method = 'lm', se = FALSE, linetype = 'dashed', size = 0.8, color = '#FF2F00') + 
  labs(x = 'Year',  title = 'Acreage Burned in California')+
  theme(plot.title = element_text(hjust=0.5),axis.title.y = element_blank())+ 
  scale_y_continuous(labels = scales::comma)  
```
This graph presents the acreage burned in California. There is a clear up trend in the total amount of acreage burned each year.
```{r CAmap1,echo = FALSE, out.width = '100%'}
CAmap_cause <- ggplot() +
  geom_polygon(data = ca_df, aes(x = long, y = lat, group = group),colour = 'black') + 
  geom_polygon(data = ca_county, aes(x = long, y = lat,group=group),colour='white') +
  geom_point(data = ca_FG_fires, aes(x = LONGITUDE, y = LATITUDE,colour=ca_FG_fires$STAT_CAUSE_DESCR )) +
  labs(color = "Cause of fire", title='Large Wildfires by Cause in California', x='Longitude', y ='Latitude')
  CAmap_cause + theme_light()+ theme(plot.title = element_text(hjust=0.5))
```

This map presents 13 causes of large wildfires in California. The top three causes of large wildfires in California are lightning, miscellaneous, and equipment use. In Northern California, there is a large amount of fires caused by lightning equipment, for example, the Tubbs Fire that destroyed my home in 2017.

### Large Wildfires in Florida

```{r FLmap2 ,echo = FALSE, out.width = '100%'}
FLmap_year <- ggplot() +
  geom_polygon(data = fl_df,aes(x = long, y = lat, group = group), colour = "black") + 
  geom_polygon(data = fl_county, aes(x = long, y = lat,group=group),colour='white')+
  geom_point(data = fl_FG_fires,  aes(x = LONGITUDE, y = LATITUDE,colour=fl_FG_fires$FIRE_YEAR))+ 
  scale_colour_gradient(low = "yellow", high = "red", name='Year')+
  labs(title='Large Wildfires by Cause in Florida', x='Longitude', y ='Latitude')
  FLmap_year  + theme_light()+ theme(plot.title = element_text(hjust=0.5))
```
This map illustrates large wildfires in Florida between 1992-2015 in increments of 5 years. It indicates that the years from 1995-2005 had the most large wildfires in Florida. It also reveals that most of of the wildfires are in Southern Florida, near the Everglades.
```{r FLchart2, echo = FALSE, out.width = '100%'}
fl_FG_fires %>% 
  group_by(FIRE_YEAR) %>%
  summarize(n = sum(FIRE_SIZE)) %>%
  ggplot(aes(x = FIRE_YEAR, y = n)) + 
  geom_bar(stat = 'identity', fill = '#FCBE00') +
  geom_smooth(method = 'lm', se = FALSE, linetype = 'dashed', size = 0.8, color = '#FF2F00') + 
  labs(x = 'Year', title = 'Acerage burned in Florida')+
  theme(plot.title = element_text(hjust=0.5),axis.title.y = element_blank()) + 
  scale_y_continuous(labels = scales::comma)
```
This graph presents the acreage burned in Florida. There is a clear but small up trend in the total amount of acreage burned each year.
```{r FLmap1 ,echo = FALSE, out.width = '100%'}
FLmap_cause <- ggplot() +
  geom_polygon(data = fl_df, aes(x = long, y = lat, group = group),colour = 'black') + 
  geom_polygon(data = fl_county, aes(x = long, y = lat,group=group),colour='white') +
  geom_point(data = fl_FG_fires, aes(x = LONGITUDE, y = LATITUDE,colour=fl_FG_fires$STAT_CAUSE_DESCR )) +
  labs(color = "Cause of fire", title='Large Wildfires by Cause in Florida', x='Longitude', y ='Latitude')
  FLmap_cause + theme_light()+ theme(plot.title = element_text(hjust=0.5)) 
```
This map presents 9 causes of large wildfires in Florida. The top major cause of wildfires in Florida is lightning, which is atleast four times as much as any other cause. It comes to no surprise since Florida is the Thunderstorm Capital of America.

### Leaflet Interactive Charts
Leaflet provides an interactive google map that provides the name of the fire, acres burned, cause, years, and days burned. Feel free to explore each map by scrolling and hovering for more details and interesting information.

### Large Wildfires in California from Years 1992-2015
```{r CA leaflet}
ca_FG_fires %>%
  leaflet() %>% 
  addTiles() %>%
  addMarkers(~LONGITUDE,~LATITUDE,
             label = ~paste("Name:", FIRE_NAME, "Acres burned:", FIRE_SIZE, "Cause:",STAT_CAUSE_DESCR, 
                            "Year:", FIRE_YEAR, "Days burning", BURN_TIME))
```

### Large Wildfires in Florida from Years 1992-2015

```{r FL leaflet, echo = FALSE, out.width = '100%'}
fl_FG_fires %>%
  leaflet() %>% 
  addTiles() %>%
  addMarkers(~LONGITUDE,~LATITUDE,
             label = ~paste("Name:", FIRE_NAME, "Acres burned:", FIRE_SIZE, "Cause:",STAT_CAUSE_DESCR, 
                            "Year:", FIRE_YEAR, "Days burning", BURN_TIME))
```

### Large Wildfires in US in Year 2015

```{r US2015, echo = FALSE, out.width = '100%'}
fires %>%
  filter(FIRE_YEAR == '2015' ,( FIRE_SIZE_CLASS=='F' | FIRE_SIZE_CLASS=='G')) %>%
  leaflet() %>% 
  addTiles() %>%
  addMarkers(~LONGITUDE,~LATITUDE,
             label = ~paste("Name:", FIRE_NAME, "Acres burned:", FIRE_SIZE, "Cause:",STAT_CAUSE_DESCR, 
                            "Days burning", BURN_TIME))
```

### Large Wildfires in US in Year 1992

```{r US1992, echo = FALSE, out.width = '100%'}
fires %>%
  filter(FIRE_YEAR == '1992' ,( FIRE_SIZE_CLASS=='F' | FIRE_SIZE_CLASS=='G')) %>%
  leaflet() %>% 
  addTiles() %>%
  addMarkers(~LONGITUDE,~LATITUDE,
             label = ~paste("Name:", FIRE_NAME, "Acres burned:", FIRE_SIZE, "Cause:",STAT_CAUSE_DESCR, 
                            "Days burning", BURN_TIME))
```
There is noticable difference between the last and first year in the U.S. in the number of large wildfires.

## Conclusion:

Looking at large wildfires there does seem to be an increase in the number of large wildfires across the U.S. and across California and Florida. There are likely many causes of this but it does seem climate change is a strong cause of this. As the temperatures are increasing and weather is getting more extreme it is increasing the number of wildfires in the U.S. Thank you for reading through this project. I hope you found it interesting. 




